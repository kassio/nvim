#!/usr/bin/env bash

red() { echo -e "\033[31m $1\033[0m"; }
green() { echo -e "\033[0;32m$1\033[0m"; }
yellow() { echo -e "\033[0;33m$1\033[0m"; }
white() { echo -e "\033[0;37m$1\033[0m"; }

command_exists() { return $(eval "$1 &>/dev/null"; echo $?); }

test_dependency() {
  if command_exists "$1"; then
    green "  ✔  $2 is already installed."
    return 0
  else
    red "   ✖  You need to install $2.\c"
    white "\n     $3\n"
    return 1
  fi
}

yellow ">> Updating python client."
(
  pip uninstall neovim -y -q &>/dev/null
  pip install neovim -q
); result=$?; [ $result != 0 ] && exit $result

yellow "\n>> Checking the environment."

(
  set -e
  test_dependency "command -v "lua"" "lua"
  test_dependency "command -v "jshint"" "jshint" "npm install -g jshint"
  test_dependency "command -v "scss-lint"" "scss-lint" "gem install scss-lint"
  test_dependency "pip list | grep neovim" "neovim python client" "pip install neovim"
); result=$?; [ $result != 0 ] && exit $result

yellow "\n>> Updating neovim."
brew tap neovim/neovim 2>/dev/null
brew update
brew reinstall --HEAD neovim

nvim --version
