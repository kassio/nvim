#!/usr/bin/env bash

__pack() {
  local cmd
  case "$1" in
    -u | --update)
      cmd="PlugClean! | PlugUpdate!"
      ;;
    *)
      cmd="PlugInstall!"
      ;;
  esac

  local coc_extensions="$(
    cd "$(dirname $0)/.."
    cat coc-extensions | tr '\n' ' '
  )"

  nvim \
    +"silent PlugUpgrade" \
    +"silent ${cmd}" \
    +"CocInstall -sync ${coc_extensions}" \
    +"qall!"
}

plug="${HOME}/.local/share/nvim/site/autoload/plug.vim"

if [ ! -f "${plug}" ]; then
  curl -sfLo "${plug}" --create-dirs \
    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
fi

__pack "$@"
